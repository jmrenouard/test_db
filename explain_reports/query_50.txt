QUERY:
WITH MaxDepSal AS (SELECT de.dept_no, MAX(s.salary) as max_sal FROM dept_emp de JOIN salaries s ON de.emp_no = s.emp_no WHERE s.to_date = '9999-01-01' GROUP BY de.dept_no) SELECT de.emp_no, de.dept_no, s.salary FROM dept_emp de JOIN salaries s ON de.emp_no = s.emp_no JOIN MaxDepSal mds ON de.dept_no = mds.dept_no AND s.salary = mds.max_sal WHERE s.to_date = '9999-01-01'

EXPLAIN PLAN:
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	de	index	PRIMARY,dept_no	dept_no	16	NULL	331143	Using index
1	PRIMARY	<derived2>	ref	key0	key0	16	employees.de.dept_no	1	
1	PRIMARY	s	ref	PRIMARY	PRIMARY	4	employees.de.emp_no	9	Using where
2	LATERAL DERIVED	de	ref	PRIMARY,dept_no	dept_no	16	employees.de.dept_no	1	Using index
2	LATERAL DERIVED	s	ref	PRIMARY	PRIMARY	4	employees.de.emp_no	9	Using where

